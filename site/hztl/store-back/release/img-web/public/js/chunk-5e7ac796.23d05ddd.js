(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5e7ac796"],{1148:function(e,t,a){"use strict";var i=a("a691"),n=a("1d80");e.exports="".repeat||function(e){var t=String(n(this)),a="",r=i(e);if(r<0||r==1/0)throw RangeError("Wrong number of repetitions");for(;r>0;(r>>>=1)&&(t+=t))1&r&&(a+=t);return a}},"14af":function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"gradeRules"},[e.data.isEditing?a("div",[e.data.rules?a("div",{staticClass:"edit_rules"},[a("p",[a("el-radio-group",{on:{change:e.radioChangeFn},model:{value:e.data.rules.condType,callback:function(t){e.$set(e.data.rules,"condType",t)},expression:"data.rules.condType"}},[a("el-radio",{staticStyle:{"margin-right":"16px"},attrs:{label:1}},[e._v("满足勾选的任一条件")]),a("el-radio",{staticStyle:{"margin-right":"16px"},attrs:{label:2}},[e._v("满足勾选的全部条件")]),e.isNoway?e._e():a("el-radio",{attrs:{label:3}},[e._v("无门槛")])],1)],1),e._l(e.data.rules.details,(function(t,i){return[a("p",{key:i},[a("el-checkbox",{attrs:{disabled:e.checkboxDisabled},on:{change:function(a){return e.checkboxChangeFn(a,t)}},model:{value:t.checked,callback:function(a){e.$set(t,"checked",a)},expression:"item.checked"}}),0!=t.type?a("el-select",{staticStyle:{width:"100px",margin:"4px 8px"},attrs:{disabled:e.checkboxDisabled,size:"mini",placeholder:"请选择"},on:{change:e.changeFn},model:{value:t.period,callback:function(a){e.$set(t,"period",a)},expression:"item.period"}},e._l(e.timeList,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1):e._e(),a("span",{staticStyle:{"margin-right":"10px"},style:{marginLeft:0==t.type?"8px":""}},[e._v(" "+e._s(e.renderTypeName(t)))]),0!=t.type?a("el-input",{staticStyle:{width:"100px"},attrs:{disabled:e.checkboxDisabled,type:"number",size:"mini",min:0},on:{change:function(a){return e.InputChange(t)}},model:{value:t.value,callback:function(a){e.$set(t,"value",a)},expression:"item.value"}}):e._e(),e._v(" "+e._s(2==t.type?"笔":0==t.type?"":"元")+" ")],1)]}))],2):e._e()]):a("div",[e.data.rules?a("div",[a("p",[e._v(e._s(1==e.data.rules.condType?"满足以下任一条件":2==e.data.rules.condType?"满足以下全部条件":"无门槛"))]),e._l(e.data.rules.details,(function(t,i){return[t.checked?a("p",{key:i},[e._v(e._s(e.renderFn(t)))]):e._e()]}))],2):e._e(),e.isEmpty?a("div",[e._v("无门槛")]):e._e()])])},n=[],r=(a("159b"),a("a9e3"),a("b680"),{name:"gradeRules",data:function(){return{data:{},details:[],timeList:[{label:"历史累计",value:1},{label:"近1年",value:2},{label:"近3月",value:3},{label:"近1月",value:4},{label:"近7天",value:5},{label:"近1天",value:6}],checkboxDisabled:!1,isEmpty:!1}},props:{isEditing:Boolean,isNoway:Boolean,dataObj:Object},watch:{dataObj:function(){this.init()}},mounted:function(){this.init()},methods:{init:function(){this.data=this.dataObj,this.isNoway&&(this.checkboxDisabled=!1)},renderFn:function(e){var t="",a="",i="",n="";return 1==e.period?t="历史累计":2==e.period?t="近1年":3==e.period?t="近3月":4==e.period?t="近1月":5==e.period?t="近7天":6==e.period&&(t="近1天"),i=e.value,0==e.type?(t="",a="无门槛",i="",n=""):1==e.type?(a="购买金额达",n="元"):2==e.type?(a="消费次数达",n="笔"):3==e.type?(a="回款金额达",n="元"):4==e.type&&(a="充值金额达",n="元"),t+a+i+n},renderTypeName:function(e){var t="";return 0==e.type?t="无门槛":1==e.type?t="购买金额达":2==e.type?t="消费次数达":3==e.type?t="回款金额达":4==e.type&&(t="充值金额达"),t},radioChangeFn:function(e){3==e?(this.data.rules.details.forEach((function(e){e.type&&(e.checked=!1)})),this.checkboxDisabled=!0):this.checkboxDisabled=!1,this.changeFn()},checkboxChangeFn:function(e,t){this.changeFn()},changeFn:function(){this.$emit("change",this.data)},InputChange:function(e){e.value&&Number(e.value||0)<0&&(e.value="0"),e.value&&2!=e.type&&(e.value=Number(e.value).toFixed(2)),e.value&&2==e.type&&(e.value=Number(e.value).toFixed(0)),this.$forceUpdate(),this.$emit("change",this.data)}}}),s=r,o=(a("64cd"),a("2877")),l=Object(o["a"])(s,i,n,!1,null,"21f316e2",null);t["a"]=l.exports},"1c78":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"vip_grade"},[a("div",{staticClass:"top_btn"},[e.tableData.length>=20?a("el-tooltip",{attrs:{effect:"dark",content:"会员等级最多20个，不可再新增",placement:"top-start"}},[a("el-button",{attrs:{size:"small",type:"primary"}},[e._v("新增会员等级")])],1):a("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.addVipGradeFn}},[e._v("新增会员等级")]),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.setVipGradeUpgradeFn}},[e._v("配置等级更新模式")]),a("div",{staticClass:"tip_txt"},[e._v("* 会员等级：根据客户的消费、互动等行为来划分客户的等级，不同等级的客户享受不同的权益，才能更好的运营客户")])],1),a("div",{staticClass:"search"},[a("span",[e._v("关键字：")]),a("el-input",{staticStyle:{width:"50%","margin-right":"10px"},attrs:{placeholder:"等级名称",size:"small",clearable:""},model:{value:e.searchObj.keyword,callback:function(t){e.$set(e.searchObj,"keyword",t)},expression:"searchObj.keyword"}}),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.searchFn}},[e._v("查询")]),a("el-button",{attrs:{size:"small"},on:{click:e.resetFn}},[e._v("重置")])],1),a("el-table",{ref:"multipleTable",staticClass:"xtable",staticStyle:{width:"100%",margin:"10px 0"},attrs:{size:"small",data:e.tableData,border:"",stripe:"","tooltip-effect":"dark",height:"450px"}},[a("el-table-column",{attrs:{prop:"no",label:"等级编号",sortable:"",align:"center",width:"120"}}),a("el-table-column",{attrs:{prop:"name",label:"等级名称","show-overflow-tooltip":"",align:"center",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isEditing?a("el-input",{attrs:{size:"small",maxlength:10,placeholder:"等级名称"},model:{value:t.row.name,callback:function(a){e.$set(t.row,"name",a)},expression:"scope.row.name"}}):a("span",[e._v(e._s(t.row.name))])]}}])}),a("el-table-column",{attrs:{prop:"color",label:"等级背景",align:"center",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isEditing?a("ColorList",{attrs:{bgColor:t.row.color,colorList:e.colorList},on:{change:function(a){return e.colorChange(a,t.row)}}}):a("div",{staticClass:"bg_div",style:{background:t.row.color}})]}}])}),a("el-table-column",{attrs:{prop:"statusName",label:"等级状态",align:"center",width:"120"}}),a("el-table-column",{attrs:{prop:"rules",label:"等级规则",align:"center","min-width":"430"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("GradeRules",{attrs:{dataObj:t.row,isNoway:e.isNoway},on:{change:function(a){return e.rulesChange(a,t.row)}}})]}}])}),a("el-table-column",{attrs:{prop:"membersCount",label:"会员数",align:"center",sortable:"",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[!t.row.isEditing&&t.row.membersCount?a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.toCustomerQuery(t.row)}}},[e._v(" "+e._s(t.row.membersCount)+" ")]):a("span",[e._v(e._s(t.row.membersCount))])]}}])}),a("el-table-column",{attrs:{prop:"rights",label:"等级权益",align:"center","min-width":"400"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("GradeRights",{attrs:{dataObj:t.row},on:{change:function(a){return e.rulesChange(a,t.row)}}})]}}])}),a("el-table-column",{attrs:{fixed:"right",label:"操作",align:"center",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isEditing?a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.save(t.row)}}},[e._v("保存")]):e._e(),!t.row.isEditing&&t.row.id>0?a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.edit(t.row)}}},[e._v("编辑")]):e._e(),t.row.isEditing?a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.cancal(t.row,t.$index)}}},[e._v("取消")]):e._e(),1==t.row.status&&t.row.id>0?a("el-button",{staticClass:"txt_danger",attrs:{type:"text",size:"small"},on:{click:function(a){return e.stop(t.row)}}},[e._v("停用")]):e._e(),2==t.row.status&&t.row.id>0?a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.restart(t.row)}}},[e._v("启用")]):e._e()]}}])})],1),a("GradeUpgradeDialog",{ref:"gradeUpgrade",on:{onRefresh:e.refreshFn}})],1)},n=[],r=a("b85c"),s=a("5530"),o=(a("159b"),a("a434"),a("b0c0"),a("a9e3"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-popover",{staticClass:"color_select",attrs:{placement:"bottom",width:"500",trigger:"click",title:e.title},model:{value:e.colorVisible,callback:function(t){e.colorVisible=t},expression:"colorVisible"}},[a("div",{staticClass:"body"},[e._l(e.colorList,(function(t,i){return[a("div",{key:i,class:["bg_div",t.selected?"selected":"",t.used?"used":""],style:{background:t.color,border:"1px solid "+t.color},on:{click:function(a){return e.itemClick(t,i)}}})]}))],2),a("div",{staticStyle:{"text-align":"right","margin-top":"8px"}},[a("el-button",{attrs:{size:"small"},on:{click:e.cancel}},[e._v("取消")]),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.sure}},[e._v("确定")])],1),a("div",{staticClass:"bg_div margin_a",style:{background:e.selectColor,border:"1px solid "+e.selectColor},attrs:{slot:"reference"},slot:"reference"})])}),l=[],c=a("d4ec"),u=a("bee2"),d=a("b775"),p=function(){function e(){Object(c["a"])(this,e)}return Object(u["a"])(e,[{key:"getMemberGradeList",value:function(e){return Object(d["b"])({baseURL:d["a"].accounts,url:"/members-grades",method:"get",params:e})}},{key:"getMemberColorList",value:function(e){return Object(d["b"])({baseURL:d["a"].accounts,url:"/members/colors",method:"get",params:e})}},{key:"getMemberGradeIdNameList",value:function(e){return Object(d["b"])({baseURL:d["a"].accounts,url:"/members-grades/id-and-name",method:"get",params:e})}},{key:"updateMemberGrade",value:function(e){return Object(d["b"])({baseURL:d["a"].accounts,url:"/members-grades",method:"post",data:e})}},{key:"updateMemberGradeStatus",value:function(e){return Object(d["b"])({baseURL:d["a"].accounts,url:"/members-grades/status/".concat(e.id),method:"post",data:e.obj})}},{key:"setMemberGradeUpgrade",value:function(e){return Object(d["b"])({baseURL:d["a"].accounts,url:"/members-grades/auto-upgrade",method:"post",data:e})}},{key:"getMemberGradeAutoUpgrade",value:function(e){return Object(d["b"])({baseURL:d["a"].accounts,url:"/members-grades/auto-upgrade",method:"get",params:e})}},{key:"exportGradeUpgrade",value:function(e){return Object(d["b"])({baseURL:d["a"].accounts,url:"/members-grades/auto-upgrade/export",method:"post",data:e,contentType:"application/json; charset=utf-8",responseType:"blob"})}}]),e}(),f=(new p,{name:"colorList",data:function(){return{title:"选择等级背景",colorVisible:!1,selectColor:"#FA8C16"}},props:{bgColor:String,colorList:Array},watch:{bgColor:function(){this.init()},colorList:function(){this.init()}},mounted:function(){this.init()},methods:{init:function(){var e=this;e.selectColor=e.bgColor,e.colorList.forEach((function(t,a){e.bgColor==t.color?(t.selected=!0,t.used=!1):t.selected=!1}))},itemClick:function(e,t){var a=this;e.used||a.colorList.forEach((function(e,i){t==i?(e.selected=!0,a.selectColor=e.color):e.selected=!1}))},cancel:function(){this.selectColor=this.bgColor,this.colorVisible=!1},sure:function(){this.colorVisible=!1,this.$emit("change",this.selectColor)}}}),h=f,b=(a("7b1a"),a("2877")),m=Object(b["a"])(h,o,l,!1,null,"593b09da",null),g=m.exports,v=a("14af"),y=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"gradeRights"},[e.data.isEditing?a("div",[e.data.rights&&e.data.rights.length?a("div",{staticClass:"edit_rules"},[e._l(e.data.rights,(function(t,i){return["garage"===e.$store.state.base.companyType||1===t.type?a("p",{key:i,staticClass:"rights_div"},[a("span",[a("el-checkbox",{on:{change:e.changeFn},model:{value:t.checked,callback:function(a){e.$set(t,"checked",a)},expression:"item.checked"}}),a("span",{staticStyle:{margin:"0 8px"}},[e._v(" "+e._s(e.renderTypeName(t)))]),1==t.type?a("span",{staticStyle:{margin:"0 8px"}},[e._v("享受价格类型")]):e._e(),1==t.type?a("el-select",{staticStyle:{width:"100px",margin:"4px 8px"},attrs:{size:"mini",placeholder:"请选择"},on:{change:e.changeFn},model:{value:t.priceType,callback:function(a){e.$set(t,"priceType",a)},expression:"item.priceType"}},e._l(e.priceTypeList,(function(e){return a("el-option",{key:e.value,attrs:{label:e.name,value:e.Code}})})),1):e._e()],1),a("span",{style:{marginLeft:1==t.type?"90px":""}},[a("span",[e._v(e._s(1==t.type?"配件折扣":2==t.type?"项目折扣":"套餐折扣"))]),0!=t.type?a("el-input",{staticStyle:{width:"100px",margin:"4px 8px"},attrs:{type:"number",size:"mini",min:0,max:10},on:{change:function(a){return e.InputChange(t)}},model:{value:t.value,callback:function(a){e.$set(t,"value",a)},expression:"item.value"}}):e._e(),e._v(" 折 ")],1)]):e._e()]}))],2):e._e()]):a("div",[e.data.rights&&e.data.rights.length?a("div",[e._l(e.data.rights,(function(t,i){return[t.checked?a("p",{key:i},[e._v(e._s(e.renderFn(t)))]):e._e()]}))],2):e._e(),e.isEmpty?a("div",{staticStyle:{color:"#999999"}},[e._v("（空）")]):e._e()])])},w=[],_=(a("b680"),{name:"gradeRights",data:function(){return{data:{},priceTypeList:[{name:"零售价",Code:"retail"},{name:"平台价",Code:"alliance"},{name:"批发价",Code:"p"},{name:"批发价一",Code:"p1"},{name:"批发价二",Code:"p2"},{name:"批发价三",Code:"p3"},{name:"批发价四",Code:"p4"}],isEmpty:!1}},props:{isEditing:Boolean,dataObj:Object},watch:{dataObj:function(){this.init()}},mounted:function(){this.init()},methods:{init:function(){this.data=this.dataObj;var e=!0;this.data.rights.forEach((function(t){t.checked&&(e=!1)})),e&&(this.isEmpty=!0)},renderFn:function(e){var t="",a="",i="";return"garage"===this.$store.state.base.companyType?1==e.type?(t="配件权益：",i="配件折扣【".concat(e.value,"折】"),this.priceTypeList.forEach((function(t){e.priceType==t.Code&&(a+="享受价格类型【".concat(t.name,"】"))}))):2==e.type?(t="项目权益：",a="",i="项目折扣【".concat(e.value,"折】")):3==e.type&&(t="套餐权益：",a="",i="套餐折扣【".concat(e.value,"折】")):1==e.type&&(t="配件权益：",i="配件折扣【".concat(e.value,"折】"),this.priceTypeList.forEach((function(t){e.priceType==t.Code&&(a+="享受价格类型【".concat(t.name,"】"))}))),t+a+i},renderTypeName:function(e){var t="";return 1==e.type?t="零配件权益":2==e.type?t="项目权益":3==e.type&&(t="套餐权益"),t},changeFn:function(){this.$emit("change",this.data)},InputChange:function(e){e.value&&Number(e.value||0)<0?e.value="0":e.value&&Number(e.value||10)>10&&(e.value="10"),e.value&&(e.value=Number(e.value).toFixed(2)),this.$forceUpdate(),this.$emit("change",this.data)}}}),k=_,x=(a("eff9"),Object(b["a"])(k,y,w,!1,null,"6738bd26",null)),C=x.exports,j=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{staticClass:"gradeUpgradeDialog",attrs:{title:e.title,visible:e.Visible,"close-on-click-modal":!1,width:"800px"},on:{"update:visible":function(t){e.Visible=t},close:e.closedFn}},[a("div",[a("p",{staticClass:"item_set"},[a("span",{staticStyle:{"margin-right":"8px"}},[e._v("客户等级自动更新")]),a("span",{staticClass:"item_switch"},[a("el-switch",{model:{value:e.auto,callback:function(t){e.auto=t},expression:"auto"}}),e.auto?a("span",{staticClass:"switch-yes",staticStyle:{bottom:"0px",left:"6px"}},[e._v("是")]):e._e(),e.auto?e._e():a("span",{staticClass:"switch-no",staticStyle:{bottom:"0px",left:"20px"}},[e._v("否")])],1)]),a("p",[a("span",{staticClass:"greyColor"},[e._v("开启：将按等级规则实时更新所有客户的会员等级")])]),a("p",[a("span",{staticClass:"greyColor"},[e._v("关闭：将从关闭起暂停更新客户的会员等级，所有客户会员等级停留在当前，不再自动升级，商家可手动给客户设置会员等级")])]),a("p",[a("span",{staticClass:"color-warning"},[e._v("*注意：若你将自动升/降级开关由关闭设置为开启时则你之前给客户手动设置的会员等级将立即失效，系统将在你开启的同时自动按照升/降级规则去更新所有客户的会员等级")])])]),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:e.closedFn}},[e._v("取消")]),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.onSave}},[e._v("确定")])],1)]),a("el-dialog",{staticClass:"gradeUpgradeDialog",attrs:{title:e.tipTitle,visible:e.tipVisible,"close-on-click-modal":!1,width:"800px"},on:{"update:visible":function(t){e.tipVisible=t},close:e.closedTipFn}},[a("div",[a("p",{staticClass:"item_set"},[e.auto?a("span",[e._v("你确定要开启自动升级吗？开启后你之前给客户手动设置的会员等级将立即失效，系统将在你开启的同时自动按照升级规则去更新所有客户的会员等级")]):a("span",[e._v("你确定要关闭自动升级吗？关闭后系统将暂停更新客户的会员等级，所有客户会员等级停留在当前级别不再自动升级，你可在客户查询中手动给客户配置会员等级")])]),a("div",{staticClass:"item_set",staticStyle:{"justify-content":"space-between"}},[a("div",[a("span",{staticClass:"color-warning"},[e._v("*")]),a("span",[e._v("若【确认更新】下列客户的会员等级将会进行更新，更新情况如下：")])]),a("el-button",{attrs:{size:"small",type:"text"},on:{click:e.onExport}},[e._v("导出Excel")])],1),a("el-table",{ref:"upgradeTable",staticClass:"xtable",staticStyle:{width:"100%",margin:"10px 0"},attrs:{size:"small",data:e.tableData,border:"",stripe:"","tooltip-effect":"dark","max-height":e.maxHeight}},[a("el-table-column",{attrs:{prop:"customerName",label:"客户名称",align:"center","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"currentGrade",label:"当前会员等级",align:"center","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.currentGrade?a("span",{class:["color-warning"]},[e._v(" "+e._s(t.row.currentGrade)+" ")]):a("span",[e._v("无")])]}}])}),a("el-table-column",{attrs:{prop:"upgradeGrade",label:"更新后会员等级",align:"center","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.upgradeGrade?a("span",{class:["color-success"]},[e._v(" "+e._s(t.row.upgradeGrade)+" ")]):a("span",[e._v("无")])]}}])}),a("el-table-column",{attrs:{prop:"upgradeType",label:"更新类型",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{class:["降级"==t.row.upgradeType?"":"color-success"]},[e._v(" "+e._s(t.row.upgradeType)+" ")])]}}])})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:e.closedTipFn}},[e._v("取消")]),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.onConfirm}},[e._v("确认更新")])],1)])],1)},O=[],E=(a("2b3d"),a("d3b7"),a("3ca3"),a("ddb0"),new p),$={name:"gradeUpgradeDialog",data:function(){return{Visible:!1,title:"配置等级更新模式",auto:!1,tipTitle:"提示",tipVisible:!1,tableData:[],maxHeight:"300"}},mounted:function(){},methods:{init:function(){var e=this;E.getMemberGradeAutoUpgrade().then((function(t){e.auto=t}))},show:function(){this.Visible=!0,this.init()},closedFn:function(){this.Visible=!1},onSave:function(){var e=this,t={auto:this.auto,confirm:!1};this.tableData=[],E.setMemberGradeUpgrade(t).then((function(t){e.tipVisible=!0,t&&(e.tableData=t)}))},closedTipFn:function(){this.tipVisible=!1},onConfirm:function(){var e=this,t={auto:this.auto,confirm:!0};E.setMemberGradeUpgrade(t).then((function(t){e.$message.success("设置成功"),e.tipVisible=!1,e.Visible=!1,e.$emit("onRefresh")}))},onExport:function(){var e=this;E.exportGradeUpgrade().then((function(t){e.$message.success("导出成功");var a=window.URL.createObjectURL(new Blob([t])),i=document.createElement("a");i.href=a;var n="客户等级列表_".concat(e.$dayjs().format("YYYY-MM-DD"),".xls");i.setAttribute("download",n),i.click()}))}}},S=$,T=(a("5a77"),Object(b["a"])(S,j,O,!1,null,"1fa2fdb7",null)),F=T.exports,L=new p,D={isEditing:!0,no:"1",id:0,name:"",color:"",status:1,statusName:"启用",rules:{condType:3,details:[{type:1,checked:!1,period:1,value:""},{type:2,checked:!1,period:2,value:""},{type:4,checked:!1,period:4,value:""}]},membersCount:0,rights:[{type:1,checked:!1,value:"",priceType:"retail"},{type:2,checked:!1,value:""},{type:3,checked:!1,value:""}]},N={name:"vipGrade",components:{ColorList:g,GradeRules:v["a"],GradeRights:C,GradeUpgradeDialog:F},data:function(){return{searchObj:{},tableData:[],addObj:{},colorList:[],hasSelectColorList:[],isEditing:!1,isNoway:!1}},created:function(){this.getColorList()},mounted:function(){this.initData()},methods:{getColorList:function(){var e=this;this.colorList=[];var t={type:1};L.getMemberColorList(t).then((function(t){e.colorList=t}))},toCustomerQuery:function(e){if(e.membersCount){var t={path:"/customerQuery",query:{memberGradeId:e.id}};this.$router.push(t)}},rulesChange:function(e,t){e},colorChange:function(e,t){t.color=e},initData:function(){var e=this;this.tableData=[];var t=Object(s["a"])({},this.searchObj);this.isNoway=!1,L.getMemberGradeList(t).then((function(t){var a=t||[];a.forEach((function(t){3==t.rules.condType&&(e.isNoway=!0,t.rules.details||(t.rules.details=[{type:1,checked:!1,period:1,value:""},{type:2,checked:!1,period:2,value:""},{type:4,checked:!1,period:4,value:""}])),e.tableData.push(Object(s["a"])(Object(s["a"])({},t),{},{isEditing:!1}))}))}))},isEditingFn:function(){var e=!1;return this.tableData.forEach((function(t){t.isEditing&&(e=!0)})),e},toScrollTop:function(){var e=document.querySelector(".el-table--scrollable-y .el-table__body-wrapper");if(e){var t=e.clientHeight,a=e.scrollHeight,i=a-t+300;e.scrollTop=i}},addVipGradeFn:function(){var e=this;if(this.addObj={},this.isEditingFn())return this.$message.warning("当前正在添加或编辑会员等级，请先保存后再继续"),!1;var t=this.tableData.length;if(t<20){this.addObj=JSON.parse(JSON.stringify(D)),this.addObj.no=""+(t+1);var a,i=Object(r["a"])(this.colorList);try{for(i.s();!(a=i.n()).done;){var n=a.value;if(!n.used){this.addObj.color=n.color;break}}}catch(l){i.e(l)}finally{i.f()}var o=Object(s["a"])({},this.addObj);this.isNoway&&(o.rules.condType=1),this.tableData.push(o),setTimeout((function(){e.toScrollTop()}),200)}else this.$message.warning("会员等级最多20个，不可再新增")},setVipGradeUpgradeFn:function(){if(this.isEditingFn())return this.$message.warning("当前正在添加或编辑会员等级，请先保存后再继续"),!1;this.$refs.gradeUpgrade.show()},searchFn:function(){this.initData()},resetFn:function(){this.searchObj={},this.initData()},refreshFn:function(){this.initData()},edit:function(e){var t=!1;if(this.tableData.forEach((function(e){e.id||(t=!0)})),t)return this.$message.warning("当前正在添加会员等级，请先保存后再继续"),!1;this.tableData.forEach((function(t){t.id&&t.id==e.id?t.isEditing=!t.isEditing:t.isEditing=!1}));var a=null,i=!1;this.tableData.forEach((function(e){3==e.rules.condType&&(a=e.id,i=!0)})),i&&e.id==a?this.isNoway=!1:i&&e.id!==a?this.isNoway=!0:this.isNoway=!1},stop:function(e){var t=this,a="停用等级将对现有客户的会员等级造成影响，如需停用请提前告知客户，以免造成不必要冲突，请谨慎操作。";this.$confirm(a).then((function(a){var i={id:e.id,obj:{status:2}};L.updateMemberGradeStatus(i).then((function(e){t.$message.success("停用成功"),t.initData()}))})).catch((function(){}))},restart:function(e){var t=this,a="启用当前等级将对现有客户的会员等级重新计算，可能会导致会员等级发生变动，变动将会在一段时间内完成。";this.$confirm(a).then((function(a){var i={id:e.id,obj:{status:1}};L.updateMemberGradeStatus(i).then((function(e){t.$message.success("启用成功"),t.initData()}))})).catch((function(){}))},cancal:function(e,t){0==e.id?(this.tableData.splice(t,1),this.addObj={}):(this.getColorList(),this.initData(),this.addObj={})},save:function(e){var t=this,a=this;if(!e.name)return a.$message.warning("请输入等级名称"),!1;var i=e.rules.condType,n=e.rules.details;if(3!=i){var s,o=!1,l=Object(r["a"])(n);try{for(l.s();!(s=l.n()).done;){var c=s.value;c.checked&&(o=!0)}}catch(v){l.e(v)}finally{l.f()}if(!o)return a.$message.warning("请填写或勾选等级规则指标！"),!1}var u,d=Object(r["a"])(n);try{for(d.s();!(u=d.n()).done;){var p=u.value;if(p.checked&&p.type&&(!p.value||!Number(p.value))){if(1==p.type)return a.$message.warning("等级规则，请输入购买金额"),!1;if(2==p.type)return a.$message.warning("等级规则，请输入消费次数"),!1;if(3==p.type)return a.$message.warning("等级规则，请输入回款金额"),!1;if(4==p.type)return a.$message.warning("等级规则，请输入充值金额"),!1}}}catch(v){d.e(v)}finally{d.f()}var f,h=e.rights,b=Object(r["a"])(h);try{for(b.s();!(f=b.n()).done;){var m=f.value;if(m.checked&&m.type&&(!m.value||!Number(m.value))){if(1==m.type)return a.$message.warning("等级权益，请输入配件折扣"),!1;if(2==m.type)return a.$message.warning("等级权益，请输入项目折扣"),!1;if(3==m.type)return a.$message.warning("等级权益，请输入套餐折扣"),!1}}}catch(v){b.e(v)}finally{b.f()}var g=JSON.parse(JSON.stringify(e));delete g.isEditing,3==g.rules.condType&&(g.rules.details=[]),L.updateMemberGrade(g).then((function(a){e.isEditing=!1,t.$message.success("成功"),t.getColorList(),t.initData()})).catch((function(e){t.$message.error(e.message)}))}}},G=N,U=(a("9ac0"),Object(b["a"])(G,i,n,!1,null,"0b58d9ec",null));t["default"]=U.exports},"23df":function(e,t,a){},"313f":function(e,t,a){},"408a":function(e,t,a){var i=a("c6b6");e.exports=function(e){if("number"!=typeof e&&"Number"!=i(e))throw TypeError("Incorrect invocation");return+e}},"5a77":function(e,t,a){"use strict";a("313f")},6343:function(e,t,a){},"634a":function(e,t,a){},"64cd":function(e,t,a){"use strict";a("6343")},"7b1a":function(e,t,a){"use strict";a("23df")},"9ac0":function(e,t,a){"use strict";a("634a")},a434:function(e,t,a){"use strict";var i=a("23e7"),n=a("23cb"),r=a("a691"),s=a("50c4"),o=a("7b0b"),l=a("65f0"),c=a("8418"),u=a("1dde"),d=u("splice"),p=Math.max,f=Math.min,h=9007199254740991,b="Maximum allowed length exceeded";i({target:"Array",proto:!0,forced:!d},{splice:function(e,t){var a,i,u,d,m,g,v=o(this),y=s(v.length),w=n(e,y),_=arguments.length;if(0===_?a=i=0:1===_?(a=0,i=y-w):(a=_-2,i=f(p(r(t),0),y-w)),y+a-i>h)throw TypeError(b);for(u=l(v,i),d=0;d<i;d++)m=w+d,m in v&&c(u,d,v[m]);if(u.length=i,a<i){for(d=w;d<y-i;d++)m=d+i,g=d+a,m in v?v[g]=v[m]:delete v[g];for(d=y;d>y-i+a;d--)delete v[d-1]}else if(a>i)for(d=y-i;d>w;d--)m=d+i-1,g=d+a-1,m in v?v[g]=v[m]:delete v[g];for(d=0;d<a;d++)v[d+w]=arguments[d+2];return v.length=y-i+a,u}})},b49f:function(e,t,a){},b680:function(e,t,a){"use strict";var i=a("23e7"),n=a("a691"),r=a("408a"),s=a("1148"),o=a("d039"),l=1..toFixed,c=Math.floor,u=function(e,t,a){return 0===t?a:t%2===1?u(e,t-1,a*e):u(e*e,t/2,a)},d=function(e){var t=0,a=e;while(a>=4096)t+=12,a/=4096;while(a>=2)t+=1,a/=2;return t},p=function(e,t,a){var i=-1,n=a;while(++i<6)n+=t*e[i],e[i]=n%1e7,n=c(n/1e7)},f=function(e,t){var a=6,i=0;while(--a>=0)i+=e[a],e[a]=c(i/t),i=i%t*1e7},h=function(e){var t=6,a="";while(--t>=0)if(""!==a||0===t||0!==e[t]){var i=String(e[t]);a=""===a?i:a+s.call("0",7-i.length)+i}return a},b=l&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!o((function(){l.call({})}));i({target:"Number",proto:!0,forced:b},{toFixed:function(e){var t,a,i,o,l=r(this),c=n(e),b=[0,0,0,0,0,0],m="",g="0";if(c<0||c>20)throw RangeError("Incorrect fraction digits");if(l!=l)return"NaN";if(l<=-1e21||l>=1e21)return String(l);if(l<0&&(m="-",l=-l),l>1e-21)if(t=d(l*u(2,69,1))-69,a=t<0?l*u(2,-t,1):l/u(2,t,1),a*=4503599627370496,t=52-t,t>0){p(b,0,a),i=c;while(i>=7)p(b,1e7,0),i-=7;p(b,u(10,i,1),0),i=t-1;while(i>=23)f(b,1<<23),i-=23;f(b,1<<i),p(b,1,1),f(b,2),g=h(b)}else p(b,0,a),p(b,1<<-t,0),g=h(b)+s.call("0",c);return c>0?(o=g.length,g=m+(o<=c?"0."+s.call("0",c-o)+g:g.slice(0,o-c)+"."+g.slice(o-c))):g=m+g,g}})},b85c:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));a("a4d3"),a("e01a"),a("d3b7"),a("d28b"),a("3ca3"),a("ddb0");var i=a("06c5");function n(e,t){var a="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=Object(i["a"])(e))||t&&e&&"number"===typeof e.length){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,l=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){l=!0,s=e},f:function(){try{o||null==a["return"]||a["return"]()}finally{if(l)throw s}}}}},bee2:function(e,t,a){"use strict";function i(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function n(e,t,a){return t&&i(e.prototype,t),a&&i(e,a),e}a.d(t,"a",(function(){return n}))},d4ec:function(e,t,a){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}a.d(t,"a",(function(){return i}))},eff9:function(e,t,a){"use strict";a("b49f")}}]);
//# sourceMappingURL=chunk-5e7ac796.23d05ddd.js.map