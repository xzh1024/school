!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("hztl-ui/lib/utils/date-util"),require("hztl-ui/lib/packages/input"),require("hztl-ui/lib/utils/price-uppercase"),require("hztl-ui/lib/packages/resize-box"),require("hztl-ui/lib/packages/input-number"),require("hztl-ui/lib/packages/base64-img")):"function"==typeof define&&define.amd?define("custom-invoice",["hztl-ui/lib/utils/date-util","hztl-ui/lib/packages/input","hztl-ui/lib/utils/price-uppercase","hztl-ui/lib/packages/resize-box","hztl-ui/lib/packages/input-number","hztl-ui/lib/packages/base64-img"],t):"object"==typeof exports?exports["custom-invoice"]=t(require("hztl-ui/lib/utils/date-util"),require("hztl-ui/lib/packages/input"),require("hztl-ui/lib/utils/price-uppercase"),require("hztl-ui/lib/packages/resize-box"),require("hztl-ui/lib/packages/input-number"),require("hztl-ui/lib/packages/base64-img")):e["custom-invoice"]=t(e["hztl-ui/lib/utils/date-util"],e["hztl-ui/lib/packages/input"],e["hztl-ui/lib/utils/price-uppercase"],e["hztl-ui/lib/packages/resize-box"],e["hztl-ui/lib/packages/input-number"],e["hztl-ui/lib/packages/base64-img"])}(window,(function(e,t,i,a,s,l){return function(e){var t={};function i(a){if(t[a])return t[a].exports;var s=t[a]={i:a,l:!1,exports:{}};return e[a].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=e,i.c=t,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(a,s,function(t){return e[t]}.bind(null,s));return a},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/",i(i.s=39)}([function(e,t,i){"use strict";function a(e,t,i,a,s,l,o,n){var c,r="function"==typeof e?e.options:e;if(t&&(r.render=t,r.staticRenderFns=i,r._compiled=!0),a&&(r.functional=!0),l&&(r._scopeId="data-v-"+l),o?(c=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),s&&s.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(o)},r._ssrRegister=c):s&&(c=n?function(){s.call(this,(r.functional?this.parent:this).$root.$options.shadowRoot)}:s),c)if(r.functional){r._injectStyles=c;var u=r.render;r.render=function(e,t){return c.call(t),u(e,t)}}else{var d=r.beforeCreate;r.beforeCreate=d?[].concat(d,c):[c]}return{exports:e,options:r}}i.d(t,"a",(function(){return a}))},function(e,t){e.exports=require("vuex")},function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"d",(function(){return s})),i.d(t,"f",(function(){return o})),i.d(t,"e",(function(){return n})),i.d(t,"b",(function(){return c})),i.d(t,"c",(function(){return r}));const a=[{name:"分割线",key:"divider",type:"divider",width:4},{name:"自定义字段",key:"custom",type:"custom",width:4}];function s(e,t){let i=0;for(;l(e,`${t}-${i}`);)i++;return`${t}-${i}`}function l(e,t){return!!e.find(e=>e.key===t)}function o(e){return!!e.includes("-")&&a.find(t=>e.includes(t.key))}function n(e){return a.find(t=>e===t.key)}function c(e){return e.split("-")[0]}function r(e,t){return{width:t?e.width+"px":void 0,fontSize:e.fontSize?e.fontSize+"px":"inherit",fontWeight:e.isBold?"bold":"inherit",fontStyle:e.isOblique?"oblique":"inherit",textAlign:e.textAlign||"inherit"}}},function(e,t){e.exports=require("@vue/babel-helper-vue-jsx-merge-props")},function(e,t){e.exports=require("lodash")},function(e,t,i){"use strict";i.d(t,"c",(function(){return a})),i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return l}));const a="思锐软件 （010）60219478/60219479",s={1:"一",2:"二",3:"三"},l={backspace:8,tab:9,clear:12,enter:13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,shiftKey:16,ctrlKey:17,altKey:18,metaKey:91}},function(e,t,i){"use strict";i.d(t,"a",(function(){return u})),i.d(t,"b",(function(){return E})),i.d(t,"c",(function(){return z})),i.d(t,"d",(function(){return v})),i.d(t,"f",(function(){return L})),i.d(t,"g",(function(){return N})),i.d(t,"e",(function(){return $}));var a=i(3),s=i.n(a),l=i(11),o=i.n(l),n={components:{Draggable:o.a},props:{list:{type:Array,required:!0},clone:Function},methods:{changeHandle(e){this.$emit("change",this.list,e)}},render(){const e=arguments[0];return e("div",{class:"ht-alternative-files"},[e(o.a,s()([{class:"ht-invoice-data-group"},{attrs:this.$attrs},{on:{change:this.changeHandle},attrs:{list:this.list,clone:this.clone}}]),[this.$scopedSlots.default?this.$scopedSlots.default(this.list):this.list.map(t=>e("div",{class:"list-group-item text-ellipsis"},[e("span",{class:"file-item file-name"},[t.name,"："]),e("span",{class:"file-item ht-invoice-sample-class"},["[",t.sampleData||t.name,"]"])]))])])}},c=i(0),r=Object(c.a)(n,void 0,void 0,!1,null,null,null);r.options.__file="packages/custom-invoice/src/components/alternative-files.vue";var u=r.exports,d=i(1),p=i(7),m={computed:{...Object(d.mapState)("invoice",["showSample","invoiceLogo"]),...Object(d.mapGetters)("invoice",["logoUrl"]),logoStyle(){const{isShow:e,position:t}=this.invoiceLogo;return{display:e?"block":"none",backgroundImage:`url(${this.logoUrl})`,top:t.top+"px",left:t.left+"px"}},invoiceLogoRef(){return this.$refs.invoiceLogo}},mounted(){this.initMoveListen()},methods:{...Object(d.mapMutations)("invoice",["changeLogoPosition","setCurEditKey"]),initMoveListen(){const e=this.invoiceLogoRef;e.onmousedown=t=>{const{left:i=0,top:a=0}=this.invoiceLogo.position,s=i-t.screenX,l=a-t.screenY,o=this.$el.clientHeight-e.clientHeight,n=this.$el.clientWidth-e.clientWidth;document.onmousemove=e=>{let t=e.screenY+l,i=e.screenX+s;t<0?t=0:t>o&&(t=o),i<0?i=0:i>n&&(i=n),this.changeLogoPosition({top:t,left:i})},document.onmouseup=()=>{document.onmousemove=null,document.onmouseup=null}}}},render(){const e=arguments[0];return e("div",{class:"ht-invoice-logo"},[this.showSample?e("div",{ref:"invoiceLogo",class:"invoice-img",on:{click:()=>this.setCurEditKey(p.b)},style:this.logoStyle}):e("img",{class:"invoice-img",style:this.logoStyle,attrs:{src:this.logoUrl}})])}},h=Object(c.a)(m,void 0,void 0,!1,null,null,null);h.options.__file="packages/custom-invoice/src/components/invoice-logo.vue";var v=h.exports,g=i(10),b=i(18),f=i.n(b),y=i(15),k=i(4),x=i(2),T={props:{data:{type:Object,required:!0}},computed:{...Object(d.mapState)("invoice",["showSample"]),...Object(d.mapGetters)("invoice",["typeName","detalisData","tableData"])},methods:{formatter(e){let t=this.detalisData[e.file];if(this.showSample)t="signature"===e.type?"":""+t;else{let i=e.total||{table:"details",file:e.file};switch(e.type){case"date":t=Object(g.dateFormat)(t);break;case"uppercase":t=f()(t);break;case"areaNames":t=e=>e.join("");break;case"signature":t="";break;case"total":t=Object(k.reduce)(this.tableData[i.table],(e,t)=>e+Number(t[i.file]),0)}}return t},handleClick(e){this.$emit("click",e)}},render(){const e=arguments[0];return e("div",{class:"ht-invoice-file list-group-item item-flex-"+this.data.width,on:{click:this.handleClick},style:Object(x.c)(this.data)},[(t=>{let i;switch(t.type){case"defaultTitle":i=e("div",{class:"file-item file-value"+(this.showSample?" ht-invoice-sample-class":"")},[this.detalisData.companyName,this.typeName]);break;case"custom":i=e("pre",{class:"file-item file-value"+(this.showSample?" ht-invoice-sample-class":"")},[t.value]);break;case"defaultDate":i=e("div",{class:"file-item file-value"+(this.showSample?" ht-invoice-sample-class":"")},[t.name,"：",Object(g.dateFormatFull)(new Date),"（",this.detalisData.printCount,")"]);break;case"signature":i=e(y.Fragment,[e("div",{class:"file-item file-name"},[t.name,"："]),e("div",{class:"file-item file-value signature-file"+(this.showSample?" ht-invoice-sample-class":"")})]);break;case"divider":i=e("div",{class:"file-item file-divider"});break;default:i=e(y.Fragment,[e("div",{class:"file-item file-name"},[t.name,"："]),e("div",{class:"file-item file-value"+(this.showSample?" ht-invoice-sample-class":"")},[this.formatter(t)])])}return i})(this.data)])}},F=Object(c.a)(T,void 0,void 0,!1,null,null,null);F.options.__file="packages/custom-invoice/src/components/invoice-details-file.vue";var S=F.exports,w={props:{group:{type:String,required:!0},templateData:{type:Array,required:!0},noDataMsg:{type:String,required:!0}},computed:{...Object(d.mapState)("invoice",["curEditField"])},methods:{...Object(d.mapMutations)("invoice",["setCurEditKey"])},render(){const e=arguments[0];return e("div",{class:"ht-invoice-file-box ht-invoice-edit-details"},[e(u,s()([{},{on:this.$listeners},{},{attrs:this.$attrs},{attrs:{group:this.group,list:this.templateData},scopedSlots:{default:t=>t.length?t.map(t=>e(S,{class:this.curEditField.curEditKey===t.key?"active":"",attrs:{data:t},on:{click:()=>this.setCurEditKey(t.key)}})):e("div",{class:"no-data"},[this.noDataMsg])}}]))])}},D=Object(c.a)(w,void 0,void 0,!1,null,null,null);D.options.__file="packages/custom-invoice/src/components/invoice-edit-details.vue";var E=D.exports,O=i(19),j=i.n(O),A={props:{templateData:{type:Object,required:!0}},computed:{...Object(d.mapState)("invoice",["curEditField"]),...Object(d.mapGetters)("invoice",["tableData","curEdit"]),soureFile(){return this.templateData.soureFile},content(){return this.templateData.content},detail(){return this.tableData[this.soureFile][0]?this.tableData[this.soureFile][0]:{}}},methods:{...Object(d.mapMutations)("invoice",["setCurEditKey"]),handleTemplateChange(e){this.$emit("change",e)},handleChangeWidth(e,t){t.width=e,this.handleTemplateChange(this.content)}},render(){const e=arguments[0];return e("div",{class:`ht-invoice-edit-table${this.templateData===this.curEdit?" active":""}${this.content.length?"":" no-data-content"}`},[e(u,s()([{attrs:{group:"body"+this.soureFile,handle:".dragghandle",list:this.content}},{on:this.$listeners},{},{attrs:this.$attrs},{scopedSlots:{default:t=>t.length?t.map(t=>e(j.a,{attrs:{width:t.width},on:{"change-width":e=>this.handleChangeWidth(e,t)},class:"list-group-item "+(this.curEditField.curEditKey===t.key?"active":""),style:Object(x.c)(t,!0)},[e("div",{class:"dragghandle",on:{click:()=>this.setCurEditKey(t.key)}},[e("div",{class:"file-item file-name text-ellipsis",attrs:{title:t.name}},[t.name]),e("div",{class:"file-item ht-invoice-sample-class text-ellipsis",attrs:{title:this.detail[t.file]}},["[",this.detail[t.file],"]"])])])):e("div",{class:"no-data"},["拖拽标题列数据设置表格"])}}]))])}},C=Object(c.a)(A,void 0,void 0,!1,null,null,null);C.options.__file="packages/custom-invoice/src/components/invoice-edit-table.vue";var z=C.exports,B={props:{templateData:{type:Array,required:!0}},render(){const e=arguments[0];if(this.templateData.length)return e("div",{class:"ht-invoice-file-box"},[e("div",{class:"ht-invoice-data-group"},[this.templateData.map(t=>e(S,{attrs:{data:t}}))])])}},q=Object(c.a)(B,void 0,void 0,!1,null,null,null);q.options.__file="packages/custom-invoice/src/components/invoice-tem-details.vue";var L=q.exports,K={props:{showSample:Boolean,templateData:{type:Object,required:!0},data:{type:Array,required:!0}},computed:{content(){return this.templateData.content},columns(){return this.content.map(e=>{let t;if(this.showSample)t=e=>`[${e}]`;else if(e.formatter)t=e.formatter;else switch(e.type){case"index":t=(e,t,i)=>i+1;break;case"date":t=(e,t,i)=>i}return{...e,key:`${e.key}-${(new Date).getTime()}`,formatter:t}})}},methods:{tableCellStyle({column:e}){const t=this.columns.find(t=>t.file===e.property);return Object(x.c)(t)}},render(){const e=arguments[0];return e("div",{class:"ht-invoice-tem-table"},[e("el-table",{attrs:{data:this.data,border:!0,"row-class-name":this.showSample?"ht-invoice-sample-class":"","cell-style":this.tableCellStyle,"header-cell-style":this.tableCellStyle,size:"mini"},style:{fontSize:this.templateData.fontSize?this.templateData.fontSize+"px":"inherit"}},[this.columns.map(t=>e("el-table-column",{key:t.key||t.prop,attrs:{label:t.name,prop:t.file,width:t.width,align:t.textAlign,"show-overflow-tooltip":!0},scopedSlots:{default:({row:e,$index:i})=>t.formatter?t.formatter(e[t.file],e,i):e[t.file]}}))])])}},H=Object(c.a)(K,void 0,void 0,!1,null,null,null);H.options.__file="packages/custom-invoice/src/components/invoice-tem-table.vue";var N=H.exports,_=i(5),G={render(){const e=arguments[0];return e("div",{class:"ht-invoice-page-footer"},[e("div",{class:"print-copy-right"},[_.c])])}},M=Object(c.a)(G,void 0,void 0,!1,null,null,null);M.options.__file="packages/custom-invoice/src/components/invoice-page-footer.vue";var $=M.exports},function(e,t,i){"use strict";i.d(t,"b",(function(){return a})),i.d(t,"a",(function(){return s}));const a="printLogoKey",s={system:"system",custom:"custom"}},,,function(t,i){t.exports=e},function(e,t){e.exports=require("vuedraggable")},,,function(e,i){e.exports=t},function(e,t){e.exports=require("vue-fragment")},,,function(e,t){e.exports=i},function(e,t){e.exports=a},function(e,t,i){"use strict";i.d(t,"a",(function(){return v}));var a=i(1),s=i.n(a);var l={state:function(){return{fontSize:12}},mutations:{changeGloBalSetting(e,t){for(let i in t)e[i]=t[i]}},actions:{initGlobalData({commit:e},t){const{fontSize:i}=t;e("changeGloBalSetting",{fontSize:i})}}},o=i(4);var n={state:function(){return{curEditKey:null}},actions:{changeCurSetting({commit:e,state:t,getters:i},a){const{templateHeader:s,templateBody:l,templateFooter:n,templateTail:c}=i;s.find(e=>e.key===t.curEditKey)?e("changeTemplateHeader",s.map(e=>e.key===t.curEditKey?{...e,...a}:e)):n.find(e=>e.key===t.curEditKey)?e("changeTemplateFooter",n.map(e=>e.key===t.curEditKey?{...e,...a}:e)):c.find(e=>e.key===t.curEditKey)?e("changeTemplateTail",c.map(e=>e.key===t.curEditKey?{...e,...a}:e)):Object(o.flatten)(l.map(e=>e.content)).find(e=>e.key===t.curEditKey)&&e("changeTemplateBody",l.map(e=>({...e,content:e.content.map(e=>e.key===t.curEditKey?{...e,...a}:e)})))}},getters:{curEdit(e,t){const{templateHeader:i,templateBody:a,templateFooter:s,templateTail:l}=t;return[...i,...s,...l].find(t=>t.key===e.curEditKey)||Object(o.flatten)(a.map(e=>e.content)).find(t=>t.key===e.curEditKey)}},mutations:{setCurEditKey(e,t){e.curEditKey=t}}};var c={state:function(){return{backDetalisData:{},backTableTable:{}}},getters:{detalisData(e,t,i){const{baseDetalisFiles:a,baseTailFiles:s}=i.invoice.optionalField,l=[...s,...a];if(i.invoice.showSample){const e={printCount:0,companyName:"[公司名称]"};return l.forEach(t=>{t.file&&(e[t.file]=`[${t.sampleData||t.name}]`)}),e}return e.backDetalisData},tableData(e,t,i){if(i.invoice.showSample){let e={};return i.invoice.optionalField.baseTableFiles.forEach(t=>{e[t.soureFile]=[{}],t.content.forEach(i=>{e[t.soureFile][0][i.file]=i.sampleData||i.name})}),e}return e.backTableTable}},mutations:{setDataSource(e,t){e.backDetalisData=t&&t.header||{},e.backTableTable=t||{}}}},r=i(7);var u={state:function(){return{isShow:!1,logoType:r.a.system,customUrl:"",position:{top:0,left:0}}},getters:{logoUrl:(e,t,i)=>e.logoType===r.a.system?i.invoice.showSample?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAAAXNSR0IArs4c6QAAA19JREFUaAXtm01PE0EYx/+7bMG2BCnWlkYgXIxg4kuCJAgfwItnL15NTEz4BJxMPBgv3jx59qAeNH4A40FNtFVjomlUAiElWBdbwNKWdgX3WTPNUJZtFwYapvMkzfPMy7LPb/470+mG0bZsg20rKyvIZrMoFovY3NykqiNvuq4jFAohHo+jt7fX4dEIOJPJOLBHntADgKAHBgZgMGU9+krRRE9vd3c3dAraxYjVoDnL29jYGF888nEqlaoxEKsuywJVo/IIiFX3aJeySQFLKSsHZXBxS0La95imieXlZZTLZXR0dDibhEQigc7OTuE5tRx4fn4euVyuBmZZlgNP+4ORkRF0dXXV2kQELZ3D+Xx+GywPROALCwt8lZC45cBeFGtrayBwkdZS4Eql0pClWq027OOnQ0uBm1mUAoGAH56GfYUB/6n8bXiz+g6RSKS+alu5p6cHhiF2XRUC/ODzb5x/9A33P5ooW83/libgvr6+bZCsQKBDQ0OsKMzvG5hgb7+zXxxYW7ibMjH1dBbPZlebTnB4eBiDg4MIBoPQNM1RNBqNYnR0VPhXEiW1r+eFwfJ0mUIVN18u4uHXHO5M9OPiySDfvCMmyFgs5nx2NB5AxZ4VdoPl83ufLeHK8zlMv1rEz3WxKy1/H7/xnoAbwfJJPP6+istPfvie3/zfEBn7BvYDyxJl83vSBvczv9n1Ir0v4L3A8skurlvO/L76Yg6fzBLfdGhx04vWfmF5Ija/r50+jplLMfSHvTcX9Isqnd/Am6UiXi+twyxZmOgPYSoRxng8hHCged20ZDLpvJdmCbm90xIJy+7DfMjQMH0hilvnTuCY8T/xesC3Nmhuw31jY1/ufBNMJtwHgH+nRfdsCHyQsAya/KmwgetnIviSK8MLkL/GLeYHYGY8jnpgz0f6sGApcZrf9z6Ybgy+6uz9D5K/Ss6HgOtt14f/MGHrkzrI8q7AtF2U0XYFlhGWmBSwrMoyLqUwGwlZvVJYVmUZl1KYjYSsXiksq7KMSynMRkJWrxSWVVnGpRRmIyGrVwrLqizjUgqzkZDVK4VlVZZxKYXZSMjq205hg466uP1XfPbGWelEJlYtnU5vFQoF6eDcgJxTLXSep12MWHU6sdUO0MRIrM7JNFKYHdiS/SjeP3ZTT/xSD7+AAAAAAElFTkSuQmCC":t.detalisData.companyEmblem:e.customUrl},actions:{switchShowLogo({state:e,commit:t},i=!1){e.isShow=i,i&&t("setCurEditKey",r.b)},setLogoData({commit:e,dispatch:t},i={}){const{isShow:a,logoType:s,customUrl:l,position:o}=i;t("switchShowLogo",a),e("changeLogoType",s),e("changeCustomLogoUrl",l),e("changeLogoPosition",o)}},mutations:{changeCustomLogoUrl(e,t=""){e.customUrl=t},changeLogoType(e,t){e.logoType=t||e.logoType},changeLogoPosition(e,t={}){let{top:i=0,left:a=0}=t;e.position={top:i,left:a}}}},d=i(2);function p(e,t){return e.map(e=>{const i=t.find(t=>t.key===e.key);return i?{...i,...e,isDetails:!0}:Object(d.f)(e.key)?{...e,isDetails:!0,type:Object(d.b)(e.key)}:null}).filter(e=>e)}const m=[{name:"单据标题",key:"defaultTitle",type:"defaultTitle",width:4,fontSize:16,textAlign:"center",isBold:!0},{name:"打印时间",key:"defaultDate",type:"defaultDate",width:4,fontSize:12,textAlign:"right"}];const h={modules:{invoice:{namespaced:!0,state:function(){return{showSample:!0,typeEmun:{},type:"",name:"",id:0}},getters:{typeName:e=>e.typeEmun[e.type]},actions:{async initStoreData({commit:e,dispatch:t},i){const{typeEmun:a,baseFiles:s,temData:l,showSample:o,invoiceData:n}=i;await e("setShowSample",o),await e("setBaseFiles",s),await e("setTypeEmun",a),await t("initTemData",l),await e("setDataSource",n)},async initTemData({state:e,dispatch:t,commit:i},a){const s=a.content?JSON.parse(a.content):{},{name:l,id:o,type:n}=a;e.name=l,e.id=o,e.type=n,t("initGlobalData",s.invoiceGlobal||{fontSize:s.fontSize?s.fontSize:12}),t("setTemDataSource",s),t("setLogoData",s.invoiceLogo),i("setCurEditKey",null)}},mutations:{setShowSample(e,t=!0){e.showSample=t},setTypeEmun(e,t){e.typeEmun=t},changeInvoiceName(e,t){e.name=t}},modules:{invoiceGlobal:l,optionalField:{state:function(){return{baseDetalisFiles:[],baseTableFiles:[],baseTailFiles:[]}},getters:{altDetalisFiles:(e,t)=>[...e.baseDetalisFiles.filter(e=>Object(d.f)(e.key)||![...t.templateHeader,...t.templateFooter].find(t=>t.key===e.key))],altTailFiles:(e,t)=>e.baseTailFiles&&[...e.baseTailFiles.filter(e=>Object(d.f)(e.key)||![...t.templateTail].find(t=>t.key===e.key))],altTableFiles:(e,t)=>e.baseTableFiles.map(e=>({...e,content:e.content.filter(i=>{const a=t.templateBody.find(t=>t.soureFile===e.soureFile);return a&&!a.content.find(e=>e.key===i.key)})}))},mutations:{setBaseFiles(e,t){if(t&&t.baseDetalisFiles&&t.baseTableFiles){e.baseDetalisFiles=[...t.baseDetalisFiles.map(e=>({...e,key:"details-"+(e.key||e.file),width:e.width||1})),...m,...d.a],e.baseTailFiles=t.baseTailFiles?[...t.baseTailFiles.map(e=>({...e,key:"tail-"+(e.key||e.file),width:e.width||1})),...d.a]:[];const i=t.baseTableFiles&&t.baseTableFiles[0];i&&i.soureFile?e.baseTableFiles=t.baseTableFiles.map(e=>({...e,content:e.content.map(t=>({...t,key:`table-${e.soureFile}-${t.key||t.file}`}))||[]})):e.baseTableFiles=[{tableName:"",soureFile:"details",content:t.baseTableFiles.map(e=>({...e,key:"table-details-"+(e.key||e.file)}))||[]}]}else console.error("baseFiles 参数缺失",t),e.baseDetalisFiles=[],e.baseTableFiles=[{tableName:"",soureFile:"details",content:[]}]}}},invoiceTem:{state:function(){return{storageTemplateHeader:[],storageTemplateBody:[],storageTemplateFooter:[],storageTemplateTail:[]}},getters:{templateHeader(e,t,i){const{baseDetalisFiles:a}=i.invoice.optionalField;return p(e.storageTemplateHeader,a)},templateFooter(e,t,i){const{baseDetalisFiles:a}=i.invoice.optionalField;return p(e.storageTemplateFooter,a)},templateTail(e,t,i){const{baseTailFiles:a}=i.invoice.optionalField;return p(e.storageTemplateTail,a)},templateBody(e,t,i){const{baseTableFiles:a}=i.invoice.optionalField;return e.storageTemplateBody.map(e=>({...e,content:e.content.map(t=>{let i;return a.forEach(a=>{i||a.soureFile===e.soureFile&&a.content.forEach(e=>{e.key===t.key&&(i=e)})}),i?{...i,...t,width:t.width||100,name:i.name}:null}).filter(e=>e)}))}},actions:{setTemDataSource({state:e,rootState:t},i){const{baseTableFiles:a}=t.invoice.optionalField,s=i.templateBody&&i.templateBody[0];e.storageTemplateHeader=i.templateHeader||[],e.storageTemplateFooter=i.templateFooter||[],e.storageTemplateTail=i.templateTail||[],e.storageTemplateBody=s&&s.soureFile?i.templateBody:a.map(e=>({...e,content:i.templateBody||[]}))||[]}},mutations:{changeTemplateHeader(e,t){e.storageTemplateHeader=t},changeTemplateBody(e,t){e.storageTemplateBody=t},changeTemplateFooter(e,t){e.storageTemplateFooter=t},changeTemplateTail(e,t){e.storageTemplateTail=t}}},invoiceLogo:u,curEditField:n,invoiceData:c}}}};function v(){return new s.a.Store({...h})}},,function(e,t){e.exports=s},,,,,,,,,,,,function(e,t){e.exports=l},,,,,function(e,t,i){"use strict";i.r(t);var a=i(1),s=i(11),l=i.n(s),o=i(20),n=i(2),c=i(6),r={computed:{...Object(a.mapState)("invoice",["invoiceLogo"]),...Object(a.mapGetters)("invoice",["templateHeader","templateFooter","templateTail","altDetalisFiles","altTableFiles","altTailFiles"])},methods:{...Object(a.mapActions)("invoice",["switchShowLogo"]),cloneData(e){return Object(n.e)(e.key)?{...e,key:Object(n.d)([...this.templateFooter,...this.templateHeader,...this.templateTail],e.key)}:e}},render(){const e=arguments[0];return e("div",{class:"ht-invoice-alternative flex-container column-flex"},[e("div",{class:"page-title"},[e("span",["打印内容"]),e("span",{class:"color-gray"},["（拖拽到画布中）"])]),e("div",{class:"ht-invoice-alternative-box auto-block flex-container column-flex"},[e("div",{class:"ht-page-title sub-title"},[" 页头页尾独立字段"]),e(c.a,{attrs:{group:"header",list:this.altDetalisFiles,clone:this.cloneData},class:"auto-block"})]),!!this.altTailFiles.length&&e("div",{class:"ht-invoice-alternative-box auto-block flex-container column-flex"},[e("div",{class:"ht-page-title sub-title"},[" 尾联独立字段"]),e(c.a,{attrs:{group:"tail",list:this.altTailFiles,clone:this.cloneData},class:"auto-block"})]),this.altTableFiles.map(t=>e("div",{class:"ht-invoice-alternative-box auto-block flex-container column-flex"},[e("div",{class:"ht-page-title sub-title"},[" ",t.tableName,"表格列字段"]),e(c.a,{class:"auto-block",attrs:{group:"body"+t.soureFile,list:t.content}})])),e("div",{class:"ht-invoice-alternative-box auto-block"},[e("div",{class:"ht-page-title sub-title"},["  其他字段"]),e("div",{class:"ht-other-group"},[e("div",{class:"flex-container list-group-item"},[e("div",{class:"file-item file-name"},["图标"]),e("div",{class:"file-item file-value"},[e("el-switch",{attrs:{value:this.invoiceLogo.isShow},on:{change:this.switchShowLogo}})])])])])])}},u=i(0),d=Object(u.a)(r,void 0,void 0,!1,null,null,null);d.options.__file="packages/custom-invoice/src/invoice-alternative.vue";var p=d.exports,m=i(5),h={data:()=>({isShowEditBody:!0}),computed:{...Object(a.mapGetters)("invoice",["templateHeader","templateBody","templateFooter","templateTail","altTailFiles"]),...Object(a.mapGetters)("invoice",["tableData"])},methods:{...Object(a.mapMutations)("invoice",["changeTemplateHeader","changeTemplateFooter","changeTemplateBody","changeTemplateTail","setCurEditKey"]),bodyChange(e,t){let i=this.templateBody;i.find(t=>t.soureFile===e).content=t,this.changeTemplateBody(i)},headerChange(e,t){this.setCurEdit(t),this.changeTemplateHeader(e)},footerChange(e,t){this.setCurEdit(t),this.changeTemplateFooter(e)},tailChange(e,t){this.setCurEdit(t),this.changeTemplateTail(e)},setCurEdit(e){for(let t in e)if(["added","moved"].includes(t)){let i=e[t]&&e[t].element.key;this.setCurEditKey(i)}}},render(){const e=arguments[0];return e("div",{class:"ht-invoice-edit-warp"},[e("div",{class:"ht-invoice-edit-box"},[e("div",{class:"ht-invoice-edit-content-box"},[e("div",{class:"ht-invoice-edit-content"},[e(c.b,{attrs:{group:"header",templateData:this.templateHeader,noDataMsg:"拖拽页头页尾部字段设置"},on:{change:this.headerChange}}),e("div",{class:"ht-invoice-body-box"},[this.templateBody.map((t,i)=>this.tableData[t.soureFile]&&e("div",{class:"ht-invoice-body-block"},[t.tableName&&e("div",{class:"ht-invoice-table"},[`${m.a[i+1]}、${t.tableName}`]),e(c.c,{attrs:{templateData:t},on:{change:e=>this.bodyChange(t.soureFile,e)}})]))]),e(c.b,{attrs:{group:"header",templateData:this.templateFooter,noDataMsg:"拖拽页头页尾部字段设置"},on:{change:this.footerChange}}),e(c.d),e(c.e),!!this.altTailFiles.length&&e(c.b,{attrs:{group:"tail",templateData:this.templateTail,noDataMsg:"拖拽尾联独立字段设置"},on:{change:this.tailChange}})])])])])}},v=Object(u.a)(h,void 0,void 0,!1,null,null,null);v.options.__file="packages/custom-invoice/src/invoice-edit-warp.vue";var g=v.exports,b=i(14),f=i.n(b),y=i(22),k=i.n(y),x=i(34),T=i.n(x),F=i(7);const S=[{id:"global",name:"模版设置"},{id:"local",name:"字段设置"}];var w={data:()=>({activeName:"global"}),computed:{...Object(a.mapState)("invoice",["name","invoiceGlobal","curEditField","invoiceLogo"]),...Object(a.mapGetters)("invoice",["altDetalisFiles","altTableFiles","curEdit"]),curEditKey(){return this.curEditField.curEditKey},disInvoiceName:{get(){return this.name},set(e){this.changeInvoiceName(e.replace(/ /g,""))}},logoType:{get(){return this.invoiceLogo.logoType},set(e){this.changeLogoType(e)}},logoCustomUrl:{get(){return this.invoiceLogo.customUrl},set(e){this.changeCustomLogoUrl(e)}}},watch:{curEditKey:{handler(e){e&&(this.activeName=S[1].id)}}},methods:{...Object(a.mapMutations)("invoice",["changeInvoiceName","changeGloBalSetting","changeLogoType","changeCustomLogoUrl"]),...Object(a.mapActions)("invoice",["changeCurSetting"])},render(){const e=arguments[0];return e("div",{class:"ht-tem-setting"},[e("ht-tabs",{attrs:{tabs:S},model:{value:this.activeName,callback:e=>{this.activeName=e}}}),this.activeName===S[0].id&&e("div",[e("div",{class:"block-box"},[e("div",{class:"page-title"},["模版名称"]),e(f.a,{class:"form-value",attrs:{size:"mini"},model:{value:this.disInvoiceName,callback:e=>{this.disInvoiceName=e}}})]),e("div",{class:"block-box"},[e("div",["全局字号"]),e(k.a,{attrs:{size:"mini",placeholder:"为空则采用默认字号",min:12,step:1,max:200,"step-strictly":!0,value:this.invoiceGlobal.fontSize},on:{change:e=>this.changeGloBalSetting({fontSize:e})}})])]),this.activeName===S[1].id&&(this.curEdit?e("div",[e("div",{class:"block-box"},[e("div",["当前字号"]),e(k.a,{attrs:{size:"mini",placeholder:"为空则采用全局字号",min:12,max:200,step:1,"step-strictly":!0,value:this.curEdit.fontSize},on:{change:e=>this.changeCurSetting({fontSize:e})}})]),e("div",{class:"block-box"},[e("div",["格式"]),e("div",{class:"flex-container style-icon-group"},[e("div",{class:"style-icon-box"+(this.curEdit.isBold?" active":""),on:{click:()=>this.changeCurSetting({isBold:!this.curEdit.isBold})}},[e("svg",{attrs:{viewBox:"0 0 18 18"}},[e("path",{class:"ql-stroke",attrs:{d:"M5,4H9.5A2.5,2.5,0,0,1,12,6.5v0A2.5,2.5,0,0,1,9.5,9H5A0,0,0,0,1,5,9V4A0,0,0,0,1,5,4Z"}}),e("path",{class:"ql-stroke",attrs:{d:"M5,9h5.5A2.5,2.5,0,0,1,13,11.5v0A2.5,2.5,0,0,1,10.5,14H5a0,0,0,0,1,0,0V9A0,0,0,0,1,5,9Z"}})])]),e("div",{class:"style-icon-box"+(this.curEdit.isOblique?" active":""),on:{click:()=>this.changeCurSetting({isOblique:!this.curEdit.isOblique})}},[e("svg",{attrs:{viewBox:"0 0 18 18"}},[e("line",{class:"ql-stroke",attrs:{x1:"7",x2:"13",y1:"4",y2:"4"}}),e("line",{class:"ql-stroke",attrs:{x1:"5",x2:"11",y1:"14",y2:"14"}}),e("line",{class:"ql-stroke",attrs:{x1:"8",x2:"10",y1:"14",y2:"4"}})])]),e("div",{class:"style-icon-box"+("left"===this.curEdit.textAlign?" active":""),on:{click:()=>this.changeCurSetting({textAlign:"left"})}},[e("svg",{attrs:{viewBox:"0 0 18 18"}},[e("line",{class:"ql-stroke",attrs:{x1:"3",x2:"15",y1:"9",y2:"9"}}),e("line",{class:"ql-stroke",attrs:{x1:"3",x2:"13",y1:"14",y2:"14"}}),e("line",{class:"ql-stroke",attrs:{x1:"3",x2:"9",y1:"4",y2:"4"}})])]),e("div",{class:"style-icon-box"+("center"===this.curEdit.textAlign?" active":""),on:{click:()=>this.changeCurSetting({textAlign:"center"})}},[e("svg",{attrs:{viewBox:"0 0 18 18"}},[e("line",{class:"ql-stroke",attrs:{x1:"15",x2:"3",y1:"9",y2:"9"}}),e("line",{class:"ql-stroke",attrs:{x1:"14",x2:"4",y1:"14",y2:"14"}}),e("line",{class:"ql-stroke",attrs:{x1:"12",x2:"6",y1:"4",y2:"4"}})])]),e("div",{class:"style-icon-box"+("right"===this.curEdit.textAlign?" active":""),on:{click:()=>this.changeCurSetting({textAlign:"right"})}},[e("svg",{attrs:{viewBox:"0 0 18 18"}},[e("line",{class:"ql-stroke",attrs:{x1:"15",x2:"3",y1:"9",y2:"9"}}),e("line",{class:"ql-stroke",attrs:{x1:"15",x2:"5",y1:"14",y2:"14"}}),e("line",{class:"ql-stroke",attrs:{x1:"15",x2:"9",y1:"4",y2:"4"}})])])])]),this.curEdit.isDetails?e("div",{class:"block-box"},[e("div",["占位宽度"]),e(k.a,{attrs:{size:"mini",min:1,max:4,"step-strictly":!0,value:this.curEdit.width},on:{change:e=>this.changeCurSetting({width:e})}})]):e("div",{class:"block-box"},[e("div",["占位宽度"]),e(k.a,{attrs:{size:"mini","step-strictly":!0,value:this.curEdit.width,min:40,max:760},on:{change:e=>this.changeCurSetting({width:e})}})]),"custom"===this.curEdit.type&&e("div",{class:"block-box"},[e("div",["文字内容"]),e("el-input",{attrs:{type:"textarea",rows:3,placeholder:"输入想显示在打印单上的内容",value:this.curEdit.value},on:{input:e=>this.changeCurSetting({value:e})}})])]):this.curEditKey===F.b?e("div",{class:"block-box"},[e("el-radio",{attrs:{label:F.a.custom},model:{value:this.logoType,callback:e=>{this.logoType=e}}},["自定义图标(60px*60px)"]),e(T.a,{attrs:{"limit-size":204800},model:{value:this.logoCustomUrl,callback:e=>{this.logoCustomUrl=e}}}),e("el-radio",{attrs:{label:F.a.system},model:{value:this.logoType,callback:e=>{this.logoType=e}}},["系统图标"]),e("div",["图标可以拖动调整位置"])]):e("div",["请选择当前设置项"]))])}},D=Object(u.a)(w,void 0,void 0,!1,null,null,null);D.options.__file="packages/custom-invoice/src/tem-setting.vue";var E=D.exports,O={name:"HtCustomInvoice",componentName:"HtCustomInvoice",store:()=>Object(o.a)(),props:{typeEmun:Object,temData:{type:Object,required:!0},baseFiles:{type:Object,required:!0}},computed:{...Object(a.mapState)("invoice",["id","type","name","invoiceGlobal","invoiceLogo"]),...Object(a.mapGetters)("invoice",["templateHeader","templateBody","templateFooter","templateTail"])},watch:{baseFiles:{immediate:!0,handler(){this.$nextTick(()=>{this.initData()})}},temData(){this.initTemData(this.temData)}},methods:{...Object(a.mapActions)("invoice",["initStoreData","initTemData"]),initData(){this.initStoreData({typeEmun:this.typeEmun,baseFiles:this.baseFiles,temData:this.temData})},saveAll(){function e(e){const t={};return["key","width","value","fontSize","textAlign","isOblique","isBold"].forEach(i=>{t[i]=e[i]}),t}this.$emit("template-change",{id:this.id,type:this.type,name:this.name,content:JSON.stringify({templateHeader:this.templateHeader.map(t=>e(t)),templateBody:this.templateBody.map(t=>({...t,content:t.content.map(t=>e(t))})),templateFooter:this.templateFooter.map(t=>e(t)),templateTail:this.templateTail.map(t=>e(t)),invoiceGlobal:this.invoiceGlobal,invoiceLogo:this.invoiceLogo})})}},render(){const e=arguments[0];return e(l.a,{class:"full-height full-width ht-trashzone border-box",attrs:{group:{name:"trash",draggable:".dropitem",put:()=>!0,pull:!1},handle:".no-trash-handle"}},[e("div",{class:"flex-container ht-custom-invoice"},[e(p,{class:"ht-invoice-side"}),e("div",{class:"flex-container column-flex invoice-warp-content"},[e("div",{class:"button-group"},[e("a",{class:"link",on:{click:this.initData}},[e("i",{class:"el-icon-refresh"}),"  还原"]),"  ",e("a",{class:"link",on:{click:this.saveAll}},[e("i",{class:"el-icon-document-checked"}),"  保存"])]),e(g,{style:{fontSize:this.invoiceGlobal.fontSize+"px",fontWeight:this.invoiceGlobal.isBold?"bold":"normal",fontStyle:this.invoiceGlobal.isOblique?"oblique":"normal"},class:"auto-block"})]),e(E,{class:"ht-invoice-side"})])])}},j=Object(u.a)(O,void 0,void 0,!1,null,null,null);j.options.__file="packages/custom-invoice/src/custom-invoice.vue";var A=j.exports;A.install=function(e){e.component(A.name,A)};t.default=A}]).default}));
//# sourceMappingURL=index.js.map